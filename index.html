<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Formulário - Judiciário</title>
  <style>
    /* Estilo simples e limpo */
    body { font-family: Inter, system-ui, Arial; background:#f5f6fb; color:#111; margin:0; padding:0; display:flex; align-items:center; justify-content:center; min-height:100vh; }
    .card { background:#fff; padding:22px; border-radius:10px; box-shadow:0 6px 18px rgba(20,20,40,0.08); width:420px; max-width:95%; }
    h1 { margin:0 0 12px 0; font-size:20px; }
    label { display:block; font-size:13px; margin-top:10px; }
    input[type="text"], input[type="date"], input[type="email"], textarea { width:100%; padding:8px 10px; margin-top:6px; border-radius:6px; border:1px solid #ddd; font-size:14px; box-sizing:border-box; }
    textarea { min-height:90px; resize:vertical; }
    .btn { margin-top:12px; display:inline-block; padding:10px 14px; border-radius:8px; border:0; cursor:pointer; font-weight:600; }
    .btn-primary { background:#2b6cb0; color:white; }
    .btn-ghost { background:transparent; color:#2b6cb0; border:1px solid #cfe0ff; }
    .small { font-size:13px; color:#666; margin-top:8px; }
    .top-right { float:right; font-size:13px; }
    .message { margin-top:10px; padding:8px 10px; border-radius:6px; background:#eef9f2; color:#064; display:none; }
    .error { background:#fff1f0; color:#9b1c1c; display:none; }
    .logout { float:right; font-size:13px; color:#c00; cursor:pointer; text-decoration:underline; }
  </style>
</head>
<body>
  <div class="card" id="login-card">
    <h1>Entrar</h1>
    <form id="login-form">
      <label>Usuário
        <input id="username" type="text" placeholder="Usuário" required />
      </label>
      <label>Senha
        <input id="password" type="password" placeholder="Senha" required />
      </label>
      <button class="btn btn-primary" type="submit">Entrar</button>
      <div class="small">Usuário único: <b>judiciario</b> / Senha: <b>juz2025</b></div>
    </form>
    <div id="login-error" class="error"></div>
  </div>

  <div class="card" id="app-card" style="display:none;">
    <div style="overflow:hidden;">
      <h1>Formulário de Cadastro <span class="top-right" id="user-badge"></span></h1>
      <div class="logout" id="logout-btn">Sair</div>
    </div>

    <form id="data-form">
      <label>Nome completo
        <input id="fullName" type="text" required />
      </label>

      <label>Data
        <input id="dateField" type="date" required />
      </label>

      <label>E-mail
        <input id="emailField" type="email" />
      </label>

      <label>Observações
        <textarea id="notesField" placeholder="Observações..."></textarea>
      </label>

      <button class="btn btn-primary" type="submit">Salvar</button>
      <button class="btn btn-ghost" type="button" id="clear-btn">Limpar</button>

      <div id="success-msg" class="message">Dados salvos com sucesso!</div>
      <div id="error-msg" class="error">Erro ao salvar. Veja o console.</div>
    </form>
  </div>

  <!-- SCRIPT: Firebase + Lógica -->
  <script type="module">
    // --- IMPORTS (SDK modular via CDN) ---
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-analytics.js";
    import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";

    // --- SEU FIREBASE CONFIG (colado do seu projeto) ---
    const firebaseConfig = {
      apiKey: "AIzaSyAgEXt65mP9TlbGuUS4QzL9kczQB3ARmDM",
      authDomain: "meu-site-judiciario.firebaseapp.com",
      projectId: "meu-site-judiciario",
      storageBucket: "meu-site-judiciario.firebasestorage.app",
      messagingSenderId: "1017649751090",
      appId: "1:1017649751090:web:f786d9c20d0d97a792082b",
      measurementId: "G-124Q2B33QX"
    };

    // Inicializa Firebase
    const app = initializeApp(firebaseConfig);
    try { getAnalytics(app); } catch (e) { /* analytics pode falhar em localhost, tudo bem */ }
    const db = getFirestore(app);

    // DOM
    const loginCard = document.getElementById('login-card');
    const appCard = document.getElementById('app-card');
    const loginForm = document.getElementById('login-form');
    const loginError = document.getElementById('login-error');
    const userBadge = document.getElementById('user-badge');
    const logoutBtn = document.getElementById('logout-btn');

    const dataForm = document.getElementById('data-form');
    const successMsg = document.getElementById('success-msg');
    const errorMsg = document.getElementById('error-msg');
    const clearBtn = document.getElementById('clear-btn');

    // Credenciais solicitadas (hardcoded conforme pediu)
    const VALID_USER = 'judiciario';
    const VALID_PASS = 'juz2025';

    // Verifica login salvo
    function showAppIfLogged() {
      const logged = localStorage.getItem('loggedIn') === 'true';
      if (logged) {
        loginCard.style.display = 'none';
        appCard.style.display = 'block';
        userBadge.textContent = VALID_USER;
      } else {
        loginCard.style.display = 'block';
        appCard.style.display = 'none';
      }
    }
    showAppIfLogged();

    // LOGIN
    loginForm.addEventListener('submit', (e) => {
      e.preventDefault();
      loginError.style.display = 'none';
      const user = document.getElementById('username').value.trim();
      const pass = document.getElementById('password').value;
      if (user === VALID_USER && pass === VALID_PASS) {
        localStorage.setItem('loggedIn', 'true');
        showAppIfLogged();
      } else {
        loginError.textContent = 'Usuário ou senha inválidos.';
        loginError.style.display = 'block';
      }
    });

    logoutBtn.addEventListener('click', () => {
      localStorage.removeItem('loggedIn');
      showAppIfLogged();
    });

    // LIMPAR FORM
    clearBtn.addEventListener('click', () => {
      dataForm.reset();
    });

    // SALVAR DADOS NO FIRESTORE
    dataForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      successMsg.style.display = 'none';
      errorMsg.style.display = 'none';

      const payload = {
        nome: document.getElementById('fullName').value.trim(),
        data: document.getElementById('dateField').value,
        email: document.getElementById('emailField').value.trim(),
        observacoes: document.getElementById('notesField').value.trim(),
        criadoEm: serverTimestamp()
      };

      try {
        await addDoc(collection(db, 'submissions'), payload);
        successMsg.style.display = 'block';
        dataForm.reset();
      } catch (err) {
        console.error('Erro salvando no Firestore:', err);
        errorMsg.textContent = 'Erro ao salvar: ' + (err?.message || 'ver console');
        errorMsg.style.display = 'block';

        // dica útil ao usuário sobre permissão
        if (err?.code === 'permission-denied') {
          errorMsg.textContent += ' — verifique as regras do Firestore no Console do Firebase.';
        }
      }
    });
  </script>
</body>
</html>
